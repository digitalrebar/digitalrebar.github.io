[
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Hoping someone can lead me in the right direction. I can't figure out why a global change-stage\/map param isn't working. I'm trying to apply the discover -&gt; sledgehammer-wait stage map to my discovered machines but it the stage never moves from discover.",
        "ts": "1529348650.000438"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "```➜  ~ drpcli profiles show global | jq                                                          \n{\n  \"Available\": true,\n  \"Description\": \"Global profile attached automatically to all machines.\",\n  \"Errors\": [],\n  \"Meta\": {\n    \"color\": \"blue\",\n    \"icon\": \"world\",\n    \"title\": \"Digital Rebar Provision\"\n  },\n  \"Name\": \"global\",\n  \"Params\": {\n    \"change-stage\/map\": {\n      \"centos-6-install\": \"complete-nowait\",\n      \"discover\": \"sledgehammer-wait:success\",\n      \"ubuntu-16.04-install\": \"complete-nowait\"\n    },\n    \"local-repo\": true\n  },\n  \"ReadOnly\": false,\n  \"Validated\": true\n}\n```",
        "ts": "1529348662.000335"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "```➜  ~ drpcli machines list | jq -r '.[] | \"\\(.Name) :: \\(.Profiles) :: \\(.Stage) :: \\(.BootEnv)\"'\n<http:\/\/d94-57-a5-6b-37-18.ctilab.com|d94-57-a5-6b-37-18.ctilab.com>. :: [\"global\"] :: discover :: sledgehammer\n<http:\/\/d3c-a8-2a-1d-52-50.ctilab.com|d3c-a8-2a-1d-52-50.ctilab.com>. :: [\"global\"] :: discover :: sledgehammer\n<http:\/\/d00-50-56-bf-4d-71.ctilab.com|d00-50-56-bf-4d-71.ctilab.com>. :: [\"global\"] :: local :: local\n<http:\/\/d3c-a8-2a-1d-56-d0.ctilab.com|d3c-a8-2a-1d-56-d0.ctilab.com>. :: [\"global\"] :: discover :: sledgehammer```",
        "ts": "1529348675.000406"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Is there a log I can look at to see why the stage isn't advancing to sledgehammer-wait?",
        "ts": "1529348733.000156"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@UA98B96BA> typically this is due to an error in the `discover` stage - first step is to make sure you have the `sledgehammer` BootEnv installed and \"available\" - `drpcli bootenvs show sledgehammer | jq '.Available'`\nshould return `true`",
        "ts": "1529348940.000193"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Yep, I uploaded it\n```➜  ~ drpcli bootenvs show sledgehammer | jq '.Available'\ntrue```",
        "edited": {
            "user": "UA98B96BA",
            "ts": "1529348982.000000"
        },
        "ts": "1529348972.000514"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "second - HIGHLY recommend you ditch the `change-stage\/map` method of driving machines through Workflow - and take a look at `workflows` - which is available (oddly enough) - via the `workflows` menu item in the Portal",
        "ts": "1529348979.000522"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "good",
        "ts": "1529348987.000393"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "next step is to make sure you have the Prefs set correctly - if you can do `drpcli prefs list\n`drpcli prefs list | egrep \"default|unknown\"`",
        "ts": "1529349052.000375"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "I can do that....I was just trying to follow along with some documentation that leveraged the change-stage.map method",
        "ts": "1529349065.000537"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "hmm - which Doc link?  I updated the Quickstart a while back in `tip`",
        "thread_ts": "1529349083.000647",
        "reply_count": 3,
        "replies": [
            {
                "user": "UA98B96BA",
                "ts": "1529349115.000248"
            },
            {
                "user": "U6QFVRJNB",
                "ts": "1529349140.000425"
            },
            {
                "user": "UA98B96BA",
                "ts": "1529349241.000107"
            }
        ],
        "unread_count": 3,
        "ts": "1529349083.000647"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<https:\/\/provision.readthedocs.io\/en\/tip\/doc\/quickstart.html>",
        "ts": "1529349115.000200"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "It was the DRPv3 Training",
        "thread_ts": "1529349083.000647",
        "parent_user_id": "U6QFVRJNB",
        "ts": "1529349115.000248"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "ah - yes sorry - the training decks aren't updated yet :disappointed:",
        "thread_ts": "1529349083.000647",
        "parent_user_id": "U6QFVRJNB",
        "ts": "1529349140.000425"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "I'll try the workflow method to see if theirs a change in behavior",
        "thread_ts": "1529349083.000647",
        "parent_user_id": "U6QFVRJNB",
        "ts": "1529349241.000107"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "```➜  ~ drpcli prefs list | egrep \"default|unknown\"\n  \"defaultBootEnv\": \"sledgehammer\",\n  \"defaultStage\": \"discover\",\n  \"unknownBootEnv\": \"discovery\",\n  \"unknownTokenTimeout\": \"6000\"```",
        "ts": "1529349353.000709"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "prefs should be set correctly",
        "ts": "1529349365.000819"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Looks good",
        "client_msg_id": "a9f8e58e-8246-4031-a490-fe279ae84d06",
        "ts": "1529349375.000004"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Applied the discovery workflow and rebooting the bare metal servers now",
        "ts": "1529349492.000425"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "check the physical (or remote) console for one of the machines",
        "ts": "1529349530.000268"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "make sure it's booting the sledgehammer Stage 1 and Stage 2",
        "ts": "1529349540.000142"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "if so - log in (root\/rebar1) to the console and check the sledgehammer service log:\n`journalctl -u sledgehammer`",
        "ts": "1529349595.000268"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "I would note we are using hpe hardware if that matters",
        "ts": "1529349603.000772"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "shouldn't matter",
        "ts": "1529349616.000530"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "are you using DHCP from DRP, or external DHCP service ?",
        "ts": "1529349627.000365"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "DHCP from DRP",
        "ts": "1529349637.000131"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Just booted into stage 1",
        "ts": "1529349661.000038"
    },
    {
        "type": "message",
        "subtype": "file_share",
        "text": "<@UA98B96BA> uploaded a file: <https:\/\/rackn.slack.com\/files\/UA98B96BA\/FBAGZG0VC\/screen_shot_2018-06-18_at_2.22.32_pm.png|Screen Shot 2018-06-18 at 2.22.32 PM.png>",
        "file": {
            "id": "FBAGZG0VC",
            "created": 1529349791,
            "timestamp": 1529349791,
            "name": "Screen Shot 2018-06-18 at 2.22.32 PM.png",
            "title": "Screen Shot 2018-06-18 at 2.22.32 PM.png",
            "mimetype": "image\/png",
            "filetype": "png",
            "pretty_type": "PNG",
            "user": "UA98B96BA",
            "editable": false,
            "size": 104263,
            "mode": "hosted",
            "is_external": false,
            "external_type": "",
            "is_public": true,
            "public_url_shared": false,
            "display_as_bot": false,
            "username": "",
            "url_private": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FBAGZG0VC\/screen_shot_2018-06-18_at_2.22.32_pm.png?t=xoxe-3-3-3-3",
            "url_private_download": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FBAGZG0VC\/download\/screen_shot_2018-06-18_at_2.22.32_pm.png?t=xoxe-3-3-3-3",
            "thumb_64": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_64.png?t=xoxe-3-3-3-3",
            "thumb_80": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_80.png?t=xoxe-3-3-3-3",
            "thumb_360": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_360.png?t=xoxe-3-3-3-3",
            "thumb_360_w": 360,
            "thumb_360_h": 280,
            "thumb_480": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_480.png?t=xoxe-3-3-3-3",
            "thumb_480_w": 480,
            "thumb_480_h": 373,
            "thumb_160": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_160.png?t=xoxe-3-3-3-3",
            "thumb_720": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_720.png?t=xoxe-3-3-3-3",
            "thumb_720_w": 720,
            "thumb_720_h": 560,
            "thumb_800": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_800.png?t=xoxe-3-3-3-3",
            "thumb_800_w": 800,
            "thumb_800_h": 622,
            "thumb_960": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_960.png?t=xoxe-3-3-3-3",
            "thumb_960_w": 960,
            "thumb_960_h": 746,
            "thumb_1024": "https:\/\/files.slack.com\/files-tmb\/T02DGQYJZ-FBAGZG0VC-fa777c1da0\/screen_shot_2018-06-18_at_2.22.32_pm_1024.png?t=xoxe-3-3-3-3",
            "thumb_1024_w": 1024,
            "thumb_1024_h": 796,
            "image_exif_rotation": 1,
            "original_w": 1025,
            "original_h": 797,
            "permalink": "https:\/\/rackn.slack.com\/files\/UA98B96BA\/FBAGZG0VC\/screen_shot_2018-06-18_at_2.22.32_pm.png",
            "permalink_public": "https:\/\/slack-files.com\/T02DGQYJZ-FBAGZG0VC-96ea3f4c1a",
            "channels": [],
            "groups": [],
            "ims": [],
            "comments_count": 0
        },
        "user": "UA98B96BA",
        "upload": true,
        "display_as_bot": false,
        "username": "robert.graham",
        "bot_id": null,
        "ts": "1529349796.000556"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Doesn't like the hostname",
        "ts": "1529349812.000286"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "does your domainname in the Subnet spec have a trailing dot (`.`) ?",
        "ts": "1529349868.000070"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "that blows it up",
        "ts": "1529349870.000383"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "ah - yes, looks yours has trailing dot - please remove that from the subnet spec then it should work",
        "ts": "1529349918.000721"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "will do",
        "ts": "1529349937.000420"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "learning pains",
        "ts": "1529349953.000091"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "did you add the Subnet spec via the UX ?",
        "ts": "1529350000.000310"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "yes, just modified what was already there",
        "ts": "1529350018.000438"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "yeah - that is a UX bug that we fixed - but I don't think the fix pushed from the `tip` UX portal to the `stable` portal :disappointed:",
        "ts": "1529350038.000694"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@U02DHRR2L> pushed that fix a few weeks ago",
        "ts": "1529350044.000745"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "if you switch to the `tip` portal (the beaker icon in upper right), you'll be using the updated Portal",
        "ts": "1529350069.000569"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "but we haven't marked it \"stable\" yet - though it's been very stable and hasn't been changed in a few weeks",
        "ts": "1529350090.000013"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@UA98B96BA> any luck ?",
        "ts": "1529350717.000577"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Had to remove the machines and reboot. It was caching the domain name with the incorrect . at the end",
        "ts": "1529350946.000006"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "stage still show's discover though",
        "ts": "1529350968.000714"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "you'll also need to make sure the `defaultWorkflow` prefs (in the quickstart)",
        "ts": "1529350996.000178"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "ah yes, that was missed",
        "ts": "1529351048.000734"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "setting now",
        "ts": "1529351058.000141"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Looks good now, all 3 of my bare metal server's now booted into sledgehammer-wait",
        "ts": "1529351747.000161"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "<@U6QFVRJNB>++",
        "ts": "1529351763.000574"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Woot woot!",
        "client_msg_id": "4937e48c-b40d-4189-86c4-ad48ebab59d0",
        "ts": "1529351783.000726"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "Is there a zsh completion for drpcli?",
        "ts": "1529353994.000395"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "nope - sorry",
        "ts": "1529354009.000303"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "just BASH - no idea if any of it's compatible ...",
        "ts": "1529354024.000122"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "nope, it throws a bad option error",
        "ts": "1529354064.000221"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "```\/usr\/local\/etc\/bash_completion.d\/drpcli:type:10343: bad option: -t```",
        "ts": "1529354070.000655"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "we're open for pull requests to add it ... :slightly_smiling_face:",
        "ts": "1529354085.000565"
    },
    {
        "type": "message",
        "user": "UA98B96BA",
        "text": "sounds good, thanks",
        "ts": "1529354111.000676"
    }
]