<html><body><style>
			* {
				font-family:sans-serif;
			}
			body {
				text-align:center;
				padding:1em;
			}
			.messages {
				width:100%;
				max-width:700px;
				text-align:left;
				display:inline-block;
			}
			.messages img {
				background-color:rgb(248,244,240);
				width:36px;
				height:36px;
				border-radius:0.2em;
				display:inline-block;
				vertical-align:top;
				margin-right:0.65em;
			}
			.messages .time {
				display:inline-block;
				color:rgb(200,200,200);
				margin-left:0.5em;
			}
			.messages .username {
				display:inline-block;
				font-weight:600;
				line-height:1;
			}
			.messages .message {
				display:inline-block;
				vertical-align:top;
				line-height:1;
				width:calc(100% - 3em);
			}
			.messages .message .msg {
				line-height:1.5;
			}
		</style><div class="messages"><div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 11:14</div><div class="msg">Hmm. I appear to have managed to ?break? dhcp (not really) by having multiple vlans on client and drp server. One of the interfaces on the client has a reservation and because the vlan interfaces (e.g. `bond0.1010`, `bond0.1011` etc) get the same MAC address, they blindly get given the IP from the reservation - all vlans end up with the same IP. I thought fixing that might be as easy as adding a new Strategy that uses ifname + mac but Strategies only get passed the DHCP packet and have no knowledge of the interface :white_frowning_face:</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 12:21</div><div class="msg">Hm, I will have to think about that one.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 12:21</div><div class="msg">Can you describe your network layout in more detail?</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:38</div><div class="msg">Yeah so 4 VLANs - `boot (10.50.1.0/24)`, `storage (10.50.2.0/24)`, `migrate (10.50.3.0/24)`, `virt (10.50.4.0/24)`.
Each Client and the DRP server has a LAG `bond0` to ToR switch.
Each Client has a `p2p2` interface which is untagged on the `boot` VLAN.
DRP server has interfaces `bond0.boot (10.50.1.254)`, `bond0.storage (10.50.2.254)`, `bond0.migrate (10.50.3.254)`, `virt (10.50.4.254)`
Client servers have interfaces `p2p2 (DHCP - boot VLAN untagged)`, `bond0.storage (DHCP - storage VLAN tagged)`? (and the same for virt and migrate)</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:39</div><div class="msg">the clients are configured to PXE boot off p2p2, install C7, and have bond0 with those vlan interfaces configured (storage, virt, migrate)</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:41</div><div class="msg">they reboot, and get a dynamic lease from each interface - e.g. first server has `bond0.storage: 10.50.2.10`, `bond0.migrate: 10.50.3.10`, `bond0.virt: 10.50.4.10`</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:41</div><div class="msg">If I then go and create a reservation for the 10.50.2.10 lease for that server, and then reboot it, all `bond0.&lt;vlan&gt;` interfaces will get a 10.50.2.10 IP</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:45</div><div class="msg">this is because the reservation token is just the MAC address - and linux VLAN interfaces use the MAC address of the parent interface</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:45</div><div class="msg">which means the server has the same MAC on every VLAN interface</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 12:49</div><div class="msg">if i leave them all dynamic with no reservations, everything works fine</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 13:08</div><div class="msg">hmmm - so - I understand what is going on.  We?ll have to decide if changing the behavior will break lots of people or not.  I suspect not, but need to think about it.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 13:22</div><div class="msg">helpful if i submit a github issue with the above?</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:01</div><div class="msg">hm...</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:01</div><div class="msg">the trick will be in deciding what we should use for a unique ID.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:02</div><div class="msg">The DUID is out for several reasons.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:03</div><div class="msg">I would prefer that the MAC address stayed globally unique, but...</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:06</div><div class="msg">I prefer to not rely on server-side interface names, because they can change, and it will do Horrible Things to future DHCP failover strategies.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:12</div><div class="msg">local interface IP maybe?</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:12</div><div class="msg">(on the server-side)</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:17</div><div class="msg">cos thats what ?subnets? are anyway right, they just associate a listen address with a DHCP range</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:18</div><div class="msg">Yeah, that is what I have been leaning towards.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:19</div><div class="msg">is there ever a situation where a lease that was given out on one interface (subnet?) needs to be given out on another?</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:19</div><div class="msg">i dont know enough about DHCP to answer that :smile:</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:19</div><div class="msg">We pretty much never deal in terms of interfaces beyond the low-level packet processing loop.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:20</div><div class="msg">because they can be added, removed, updated, etc. on the fly.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:20</div><div class="msg">yeah as its so liable to change</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 14:20</div><div class="msg">every time i restart networking my vlan subinterfaces get new interface indexes, proving that point</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 14:33</div><div class="msg">hm.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 14:37</div><div class="msg">Could we track by subnet (either subnet IP from interface or giaddr field) and Mac?  The non-reservation bond path works, so we are getting the subnet parts right.  It breaks our assumption about MAC is king.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:02</div><div class="msg">Yeah, the issue @ is running into is that reservations as currently defined are a global thing -- they say "mac foo gets IP bar", not "mac foo in subnet bar gets IP baz"</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:03</div><div class="msg">I can extend them to cover that case, the question is what is the best approach.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:06</div><div class="msg">I just don't want to break the use case of being able to assign an IP to a machine even through it is not in any of our subnet definitions.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:11</div><div class="msg">The short-term workaround is to not create reservations for this particular usecase</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:12</div><div class="msg">and try not to run out of IP addresses in the subnets in question. :slightly_smiling_face:</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:12</div><div class="msg">and don't purge the expired leases.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 15:14</div><div class="msg">i mean in practice what we?d usually do is allocate the IP by DHCP on first run and then set it static on the interface</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 15:14</div><div class="msg">but i didn?t do that due to complexity and wanting to prove out something else</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 15:14</div><div class="msg">and ran into this instead :smile:</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:14</div><div class="msg">Yeah, and that is a reasonable practice.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:15</div><div class="msg">and as long as you don't run out of IPs and don't purge the leases, that will continue to work with us as well.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:17</div><div class="msg">ok, so reservations will grow a Scoped flag to deal with this use case.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-15/2462284870_72.jpg" /><div class="message"><div class="username">vlowther</div><div class="time">2018-08-03 15:19</div><div class="msg">I will need to spend a bit of time fleshing this stuff out.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 15:48</div><div class="msg"><!channel> ?  I forgot.  Sledgehammer was updated in this release.  Please update that iso if you update to v1.4.0 community content.</div></div></div><br/>
<div><img src="" /><div class="message"><div class="username"></div><div class="time">2018-08-03 16:32</div><div class="msg">@ has left the channel</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 17:55</div><div class="msg"><!here> hey guys, is it possible to use wildcards when selecting members of an object type in a tenant?</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 17:58</div><div class="msg">yes, I believe *.  Not regex</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 17:58</div><div class="msg">Interesting feature request.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:04</div><div class="msg">My interest is to select some machines that have similar names</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:04</div><div class="msg">I tried with * but it doesn't seem to work</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 18:05</div><div class="msg">yeah - `'*' or exact match.  Not "fred*"`</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 18:06</div><div class="msg">should work.   You can add each machine name, I think.  ?fred,greg,florent,victor,??</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:07</div><div class="msg">ok</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:07</div><div class="msg">I tried `'fred*'` that's why ^^</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:08</div><div class="msg">Otherwise I am currently testing RBAC.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:09</div><div class="msg">I have trouble with the claims. What exactly are the keywords for the scopes and actions ?</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:09</div><div class="msg">no suggestion is shown in the menu when I edit a role, but it is shown when creating a new one.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 18:10</div><div class="msg">`drpcli info get | jq .scopes`</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 18:10</div><div class="msg">vi</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:13</div><div class="msg">yep, I confirm, editing a role in the UX isn't working.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-07-14/2459866780_72.jpg" /><div class="message"><div class="username">greg</div><div class="time">2018-08-03 18:14</div><div class="msg">Bug what you tried, please.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:45</div><div class="msg">1. Create a new role
2. Set up the claims of the new role
3. Save it.
4. Go back to editing the previously saved role
5. Try to modify the claims or anything won't work.</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 18:49</div><div class="msg">editing with drpcli works:
`drpcli roles update prod-role '"Claims": [{"action": "list", "scope": "machines"}]'` showed no issue.</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-09-17/2677396473_72.jpg" /><div class="message"><div class="username">zehicle</div><div class="time">2018-08-03 20:52</div><div class="msg">@florent.wagener thanks, that helps.  I'll take a look</div></div></div><br/>
<div><img src="https://secure.gravatar.com/avatar/8ed489f4fec23363fa7edff0cf3fab50.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0015-72.png" /><div class="message"><div class="username">florent.wagener</div><div class="time">2018-08-03 23:20</div><div class="msg">I think my UX is unstable since the upgrade</div></div></div><br/>
<div><img src="https://avatars.slack-edge.com/2014-09-17/2677396473_72.jpg" /><div class="message"><div class="username">zehicle</div><div class="time">2018-08-03 23:27</div><div class="msg">You may need to accept the certificate from the endpoint. </div></div></div><br/>
</div></body></html>