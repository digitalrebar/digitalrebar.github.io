[
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "<@U9KSXT6CV> - if you want to try different `ipxe.efi`, you can just place them in the tftpboot directory.  If you want them to persist over drp restarts, you need to place them in the `replace` directory as well.",
        "ts": "1520518490.000600"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "If you are in `isolated` mode, these are in the directory you started drp from.",
        "ts": "1520518508.000304"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "If you are in `production` mode, these are in `\/var\/lib\/dr-provision`.",
        "ts": "1520518520.000327"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "If you find one that works, lets know where you got it from.  :slightly_smiling_face:",
        "ts": "1520518541.000344"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Hey all.  I'm trying to create a bootable iPXE image that I can use to manually point a machine at a dr-provision host on another subnet.  I'm doing this because I can't run a DHCP server on the subnet the host to be discovered lives on.",
        "ts": "1520546839.000165"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Oh and for extra complications, it's also a UEFI boot only system.",
        "ts": "1520546859.000473"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I have the image booting and am trying to chain boot bootx64.efi.  But I get the error \n```no config file found in\nforcing interactive mode due to config file error(s)\n\nELILO boot: .............```",
        "ts": "1520546926.000189"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Then just an endless string of dots.",
        "ts": "1520546932.000447"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "It never seems to get any farther.",
        "ts": "1520546937.000117"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "So it downloads bootx64.efi from the dr-prov server, but can't go any farther apparently.",
        "ts": "1520546979.000267"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "<@U9BU09D51> - There is ProxyDHCP for this case if needed.  It can in parallel only had out boot options.",
        "ts": "1520547271.000287"
    },
    {
        "type": "message",
        "subtype": "file_share",
        "text": "<@U9BU09D51> uploaded a file: <https:\/\/rackn.slack.com\/files\/U9BU09D51\/F9N2X4NG7\/menu_ipxe.txt|menu.ipxe>",
        "file": {
            "id": "F9N2X4NG7",
            "created": 1520547289,
            "timestamp": 1520547289,
            "name": "menu_ipxe.txt",
            "title": "menu.ipxe",
            "mimetype": "text\/plain",
            "filetype": "text",
            "pretty_type": "Plain Text",
            "user": "U9BU09D51",
            "editable": true,
            "size": 1229,
            "mode": "snippet",
            "is_external": false,
            "external_type": "",
            "is_public": true,
            "public_url_shared": false,
            "display_as_bot": false,
            "username": "",
            "url_private": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-F9N2X4NG7\/menu_ipxe.txt?t=xoxe-2458848645-331142845857-332542502102-c2a3393bdc66e7bf33d1c6986e4eea64",
            "url_private_download": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-F9N2X4NG7\/download\/menu_ipxe.txt?t=xoxe-2458848645-331142845857-332542502102-c2a3393bdc66e7bf33d1c6986e4eea64",
            "permalink": "https:\/\/rackn.slack.com\/files\/U9BU09D51\/F9N2X4NG7\/menu_ipxe.txt",
            "permalink_public": "https:\/\/slack-files.com\/T02DGQYJZ-F9N2X4NG7-b834a6a7f6",
            "edit_link": "https:\/\/rackn.slack.com\/files\/U9BU09D51\/F9N2X4NG7\/menu_ipxe.txt\/edit",
            "preview": "#!ipxe\r\n\r\nset dns                 8.8.8.8\r\nset next-server\t\t    X.X.X.X\r\nset filename            bootx64.efi\r",
            "preview_highlight": "<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text\/plain',window.getSelection().toString().replace(\/\\u200b\/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>#!ipxe<\/pre><\/div>\n<div><pre><\/pre><\/div>\n<div><pre>set dns                 8.8.8.8<\/pre><\/div>\n<div><pre>set next-server         X.X.X.X<\/pre><\/div>\n<div><pre>set filename            bootx64.efi<\/pre><\/div>\n<div><pre><\/pre><\/div>\n<\/div>\n<\/div>\n",
            "lines": 55,
            "lines_more": 50,
            "preview_is_truncated": true,
            "channels": [],
            "groups": [],
            "ims": [],
            "comments_count": 0
        },
        "user": "U9BU09D51",
        "upload": true,
        "display_as_bot": false,
        "username": "dave.parker",
        "bot_id": null,
        "ts": "1520547290.000314"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "<@U9BU09D51> - Second, I think we’ve dropped support fro bootx64.efi because it was buggy.  And switched to `ipxe.efi` because it worked better.  <@U02DJQSG8> will have better info.",
        "ts": "1520547324.000036"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Ok.",
        "ts": "1520547332.000543"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I can't install anything in this subnet really.  So I don't know that I can do the ProxyDHCP either.",
        "ts": "1520547367.000342"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - so - how do you control what it is going to boot the first time?",
        "ts": "1520547392.000421"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "With a bootable iso, with an iPXE executable that runs that script I posted.",
        "ts": "1520547439.000464"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - so  you could try using ipxe.efi with a pxe script that points to `http:\/\/&lt;ip&gt;:8091\/default.ipxe`",
        "ts": "1520547487.000574"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "where `&lt;ip&gt;` is your DRP endpoint.",
        "ts": "1520547499.000304"
    },
    {
        "type": "message",
        "user": "U02DJQSG8",
        "text": "yeah, that. :slightly_smiling_face:",
        "ts": "1520547508.000489"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "and `8091` is your HTTP port on the DRP endpoint.",
        "ts": "1520547534.000521"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Got it",
        "ts": "1520547544.000183"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The `default.ipxe` file is rendered with enough to handle discovery and directed boot operations.",
        "ts": "1520547579.000610"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "It is provided by the `discovery` bootenv.  It looks like this:",
        "ts": "1520547649.000230"
    },
    {
        "type": "message",
        "subtype": "file_share",
        "text": "<@U02DGQYK1> uploaded a file: <https:\/\/rackn.slack.com\/files\/U02DGQYK1\/F9M1H2DLJ\/-.md|Untitled>",
        "file": {
            "id": "F9M1H2DLJ",
            "created": 1520547667,
            "timestamp": 1520547667,
            "name": "-.md",
            "title": "Untitled",
            "mimetype": "text\/plain",
            "filetype": "markdown",
            "pretty_type": "Markdown (raw)",
            "user": "U02DGQYK1",
            "editable": true,
            "size": 559,
            "mode": "snippet",
            "is_external": false,
            "external_type": "",
            "is_public": true,
            "public_url_shared": false,
            "display_as_bot": false,
            "username": "",
            "url_private": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-F9M1H2DLJ\/-.md?t=xoxe-2458848645-331142845857-332542502102-c2a3393bdc66e7bf33d1c6986e4eea64",
            "url_private_download": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-F9M1H2DLJ\/download\/-.md?t=xoxe-2458848645-331142845857-332542502102-c2a3393bdc66e7bf33d1c6986e4eea64",
            "permalink": "https:\/\/rackn.slack.com\/files\/U02DGQYK1\/F9M1H2DLJ\/-.md",
            "permalink_public": "https:\/\/slack-files.com\/T02DGQYJZ-F9M1H2DLJ-892a04a3bc",
            "edit_link": "https:\/\/rackn.slack.com\/files\/U02DGQYK1\/F9M1H2DLJ\/-.md\/edit",
            "preview": "#!ipxe\r\nchain http:\/\/127.0.0.1:8091\/${netX\/mac}.ipxe && exit || goto chainip\r\n:chainip\r\nchain http:\/\/127.0.0.1:8091\/${netX\/ip}.ipxe && exit || goto sledgehammer\r\n:sledgehammer\r",
            "preview_highlight": "<div class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text\/plain',window.getSelection().toString().replace(\/\\u200b\/g,''));event.preventDefault();event.stopPropagation();}\">\n<div class=\"CodeMirror-code\">\n<div><pre>#!ipxe<\/pre><\/div>\n<div><pre>chain http:\/\/127.0.0.1:8091\/${netX\/mac}.ipxe &amp;&amp; exit || goto chainip<\/pre><\/div>\n<div><pre>:chainip<\/pre><\/div>\n<div><pre>chain http:\/\/127.0.0.1:8091\/${netX\/ip}.ipxe &amp;&amp; exit || goto sledgehammer<\/pre><\/div>\n<div><pre>:sledgehammer<\/pre><\/div>\n<\/div>\n<\/div>\n",
            "lines": 9,
            "lines_more": 4,
            "preview_is_truncated": false,
            "channels": [],
            "groups": [],
            "ims": [],
            "comments_count": 0
        },
        "user": "U02DGQYK1",
        "upload": true,
        "display_as_bot": false,
        "username": "greg",
        "bot_id": null,
        "ts": "1520547668.000147"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The loopback addresses are just because it is how I asked for it.",
        "ts": "1520547700.000071"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "It basically looks for ipxe files on the DRP endpoint for the machine specifically (`&lt;ip&gt;.ipxe` and `&lt;mac&gt;.ipxe`).  Bootenvs are supposed to provide one of those files for IPXE boots.",
        "ts": "1520547784.000286"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "If they don’t exist, then it boots sledgehammer and starts discovery.",
        "ts": "1520547800.000576"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Ok, cool.",
        "ts": "1520547836.000578"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I'll give that a try.",
        "ts": "1520547840.000059"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Hey, that kind of worked.",
        "ts": "1520548306.000278"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "It grabbed sledgehammer and booted into it.  But it then set the IP address to 0.0.0.0 and is just looping `Sending discover...` over and over",
        "ts": "1520548350.000216"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "sledgehammer expects DNS domain in the DHCP options, I think.",
        "ts": "1520548492.000161"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You can log into sledgehammer from the console with root\/rebar1.",
        "ts": "1520548513.000582"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "To see what DHCP client is getting upset about.",
        "ts": "1520548524.000255"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "That maybe where you are.",
        "ts": "1520548535.000148"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I can't get in because it just keeps trying to send discover.  I never get a login prompt",
        "ts": "1520549037.000237"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "So the sledgehammer image is always going to try configure the network with DHCP?  So if I can't have a DHCP server on the network (or there's one there I don't control) will sledgehammer not work?",
        "ts": "1520550424.000257"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "It needs DHCP and what you have should work.  They are a couple of things going on.",
        "ts": "1520550764.000398"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "We made a change to let dhcp and drpcli run separately in sledgehammer.  This is good, but may be preventing drpcli from running.  It is a new change.  Probably a bug.",
        "ts": "1520550812.000238"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The second is that our dhcp server requires 1 options (I think).  Dns Domain.",
        "ts": "1520550836.000358"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "We can look at removing that requirement.",
        "ts": "1520550845.000296"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "We are just a little busy with some other things at the moment.",
        "ts": "1520551110.000103"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I don't have any subnets configured on my dr-provision server currently because I'm testing these remote installs.  Do I need one configured anyway?",
        "ts": "1520551391.000100"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "No.  It is should be fine.  ",
        "client_msg_id": "7A4200AB-92C4-47B3-9FCE-D2AF941ED4B5",
        "ts": "1520551472.000287"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "There are bugs for your use case.  It would be nice to know what options your dhcp server is sending ",
        "client_msg_id": "AFE0DA30-32B5-4693-9806-2640B448241A",
        "ts": "1520551504.000194"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I don't even see anything on the server end.  Nothing in the logs at all.",
        "ts": "1520552439.000155"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Oh well I'm going to come back to this tomorrow.",
        "ts": "1520552486.000109"
    }
]