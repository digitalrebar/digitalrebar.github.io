[
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Is there a proper\/supported way to copy stages\/templates\/etc from one rebar server to another, or to restore them to a rebar server that was rebuilt?",
        "ts": "1526060580.000151"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "I've just been dumping them as json blobs and saving those.",
        "ts": "1526060593.000344"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Are you trying to create your own content library to move around between different DRP endpoints ?",
        "ts": "1526060611.000631"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "or is this a \"one off\" sort of thing for now ?",
        "ts": "1526060619.000412"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "But it seems like when I load them into another server, I often get issues.  Like a bootenv is looking for a stage that doesn't exist yet, and even after it gets created the bootenv is still complaining.",
        "ts": "1526060621.000316"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Right now it's just me having to shuffle things around to test in different environments with different drp servers.  But I can see it becoming more of a content library.",
        "ts": "1526060668.000487"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "your best option is to create a \"content pack\" that mimics how we do Content bundles or \"Packs\" - you can then bundle them up - and inject them as one big piece of content - it's a lot easier for managing the content",
        "ts": "1526060709.000479"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "you can also author those in a Git (or other source code control system) repo",
        "ts": "1526060728.000291"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "That sounds like what I want.",
        "ts": "1526060755.000478"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "if you take a look at the structure of the `content` directory in the `provision-content` repo, you'll see how to organize it:\n<https:\/\/github.com\/digitalrebar\/provision-content>",
        "attachments": [
            {
                "service_name": "GitHub",
                "title": "digitalrebar\/provision-content",
                "title_link": "https:\/\/github.com\/digitalrebar\/provision-content",
                "text": "provision-content - DigitalRebar Provision Content",
                "fallback": "GitHub: digitalrebar\/provision-content",
                "from_url": "https:\/\/github.com\/digitalrebar\/provision-content",
                "thumb_url": "https:\/\/avatars1.githubusercontent.com\/u\/13814120?s=400&v=4",
                "thumb_width": 250,
                "thumb_height": 250,
                "service_icon": "https:\/\/a.slack-edge.com\/bfaba\/img\/unfurl_icons\/github.png",
                "id": 1,
                "original_url": "https:\/\/github.com\/digitalrebar\/provision-content"
            }
        ],
        "ts": "1526060760.000398"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Ok, thanks.",
        "ts": "1526060770.000411"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "I'd suggest instead of calling it generically \"content\" call it \"package-x\" or whatever name you want to give your content pack",
        "ts": "1526060787.000712"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Can it include any type of content?  Workflows and tasks and profiles?",
        "ts": "1526060818.000665"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "then the subsequent sub-dirs (eg `bootenvs`, `params`, `stages`, `tasks`, etc...) contain your decomposed content pieces",
        "ts": "1526060822.000012"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": ":slightly_smiling_face: ^^^^",
        "ts": "1526060826.000273"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "lol ok",
        "ts": "1526060831.000621"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "yes - any toplevel object in the JSON structure relates to a directory",
        "ts": "1526060844.000542"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Thankfully I've already been saving them in such subdirectories.",
        "ts": "1526060852.000759"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "then simply `cd` in to that directory, and use `drbundler . ..\/package-x.yaml` syntax to create the Content pack",
        "ts": "1526060871.000704"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "So it looks like I need the content bit to pull it all together.",
        "ts": "1526060874.000255"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "important -note the `._*.meta` files for naming, versioning, describing your content package",
        "ts": "1526060897.000597"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "they MUST not contain a newline - so create them like:  `printf \"v1.0.0\" &gt; ._Version.meta` without the newline",
        "ts": "1526060937.000251"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "from there - you can simply do your `drpcli contents create ..\/package-x.yaml` call to create it - replace \"create\" with \"update\" call (appropriately) - and you can update existing content packs in place",
        "ts": "1526060988.000755"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "it's the sanest way to deal with multiple pieces of content, so you can revision it, manage it as a single unit, and easily inject it in to your DRP endpoints",
        "ts": "1526061024.000120"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "there's an example Content Pack called `colordemo` which contains some video links to how it was created\/managed as an example:\n<https:\/\/github.com\/digitalrebar\/colordemo>",
        "attachments": [
            {
                "service_name": "GitHub",
                "title": "digitalrebar\/colordemo",
                "title_link": "https:\/\/github.com\/digitalrebar\/colordemo",
                "text": "colordemo - Training Content",
                "fallback": "GitHub: digitalrebar\/colordemo",
                "from_url": "https:\/\/github.com\/digitalrebar\/colordemo",
                "thumb_url": "https:\/\/avatars1.githubusercontent.com\/u\/13814120?s=400&v=4",
                "thumb_width": 250,
                "thumb_height": 250,
                "service_icon": "https:\/\/a.slack-edge.com\/bfaba\/img\/unfurl_icons\/github.png",
                "id": 1,
                "original_url": "https:\/\/github.com\/digitalrebar\/colordemo"
            }
        ],
        "ts": "1526061076.000331"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": ":thumbsup:",
        "ts": "1526061394.000375"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@U9BU09D51> if you run in to any issues with validation you think need addressing - please let us know right away - generally speaking - we've found that the validation pieces are usually \"right\" when something is amiss - they keep you from trying to provision if requirements (ugh correction ==&gt;) `aren't` properly fulfilled",
        "edited": {
            "user": "U6QFVRJNB",
            "ts": "1526061623.000000"
        },
        "ts": "1526061434.000239"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Ok",
        "ts": "1526061540.000416"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "<!here> is it possible for DRP to run powershell code on a windows machine ?",
        "ts": "1526063693.000483"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "technically - there's no reason it can't ...",
        "ts": "1526063787.000533"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Personally - I won't touch a winders machine ... so ... can't advise on any pitfalls",
        "ts": "1526063804.000657"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "Ok because I'm having trouble with a piece of code that works fine locally, but when I run it from DRP it is failing",
        "ts": "1526063845.000114"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "I think I missed something",
        "ts": "1526063859.000631"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "I created a task with this piece of code in it:\n```$nics = Get-Content -Raw -Path C:\\network.json | ConvertFrom-Json\n$adapters = Get-NetAdapter\nforeach ($nic in $nics.config)\n    {\n        foreach ($adapter in $adapters) \n            {\n                if ($adapter.MacAddress -eq ($nic.mac_address -replace \":\",\"-\")) \n                    {\n                        Get-NetAdapter -Name $adapter.name | Rename-NetAdapter -NewName $nic.name\n                    }\n            }\n    }\nNew-NetLbfoTeam -Name $nics.config[6].name -TeamMembers $nics.config[6].bond_interfaces```",
        "ts": "1526063895.000604"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "and put that task in a stage",
        "ts": "1526063902.000630"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "but it's failing without any logs though.",
        "ts": "1526063912.000149"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "Don't I have to put something in the script to tell it is powershell  code?",
        "edited": {
            "user": "U8FAN7PLK",
            "ts": "1526063950.000000"
        },
        "ts": "1526063940.000035"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "presumably that is part of the `Content:` section of the task ?",
        "ts": "1526063947.000281"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "Yes it is",
        "ts": "1526063955.000005"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "do you have `ID:` defined too ?",
        "ts": "1526063964.000440"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "does powershell need to be invoked similarly to BASH with a shebang construct of some sort ?",
        "ts": "1526064001.000365"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "The name of the content is: `bond-creation.ps1` which is what you refer as `ID:` I guess.",
        "ts": "1526064033.000247"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "and I have no idea how to invoke powershell :smile:",
        "ts": "1526064053.000068"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "So I get these errors when trying to load my content package into another machine.  I presume because these things already exist on that server outside the content package.  Is there anyway I can override this and force it to install?\n```Error: ValidationError: New layer violates key restrictions: keysCannotBeOverridden: create-kvmstore is already in layer 0\n\tkeysCannotOverride: create-kvmstore would be overridden by layer 0\n\tkeysCannotBeOverridden: install-mellanox-drivers-ubuntu-1404 is already in layer 0\n\tkeysCannotOverride: install-mellanox-drivers-ubuntu-1404 would be overridden by layer 0\n\tkeysCannotBeOverridden: ubuntu-16.04.hwe-install is already in layer 0\n\tkeysCannotOverride: ubuntu-16.04.hwe-install would be overridden by layer 0```",
        "ts": "1526064077.000370"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "nope - we won't let you overwrite existing content pieces if they already exist and are _not_ part of the content pack",
        "ts": "1526064139.000624"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "that is the one limitation to multiple content packs - you can't have conflicting content pieces (by name)",
        "ts": "1526064161.000588"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Ok.",
        "ts": "1526064218.000206"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "so we tend to name a lot of our stuff pedantically to insure we don't conflict - like:\n`liveboot-builder` is the package\n`kickstart` is a parameter\nso we name it like:\n`liveboot-builder\/kickstart`",
        "ts": "1526064221.000016"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "(which has the unfortunate sideeffect of manipulation in `jq` being a nightmare (that forward slash, and the dashes)",
        "ts": "1526064263.000390"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@U8FAN7PLK> `ID` and `Content` I believe are mutually exclusive - `ID` relates to the external `template` to use for the task, whereas `Content` is a \"built-in template content\"",
        "edited": {
            "user": "U6QFVRJNB",
            "ts": "1526064336.000000"
        },
        "ts": "1526064331.000577"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "<@U6QFVRJNB> ok, so there is no ID configured.",
        "ts": "1526064379.000210"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "ok - good :slightly_smiling_face:",
        "ts": "1526064387.000186"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "ok, so I'm not even able to run a simple windows command as `ipconfig &gt; ipconfig.txt`",
        "ts": "1526065104.000191"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "This is not a very helpful error message:\n```Error: Failed to load backing objects from cache: Unable to load root templates: template: :455: unexpected \"\\\\\" in operand```",
        "ts": "1526065139.000669"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "Got that when trying to load my content package on a fresh drp install.",
        "ts": "1526065159.000702"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "damn I hate windows...",
        "ts": "1526065224.000545"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "what does line 455 of the yaml content pack file have ?",
        "ts": "1526065234.000463"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "<@U8FAN7PLK> - yeah, I was just reading up on powershell ... and ... well ... and ... well ... I don't have much positive to say about it ...",
        "ts": "1526065267.000345"
    },
    {
        "type": "message",
        "user": "U9BU09D51",
        "text": "It only has 356 lines...",
        "ts": "1526065281.000269"
    },
    {
        "type": "message",
        "user": "U02DJQSG8",
        "text": "<@U8FAN7PLK> Yeah, I don't think we have ever tested running scripts on Windows.",
        "ts": "1526065286.000274"
    },
    {
        "type": "message",
        "user": "U02DJQSG8",
        "text": "We can put them in place to be run, but powershell can be very picky.",
        "ts": "1526065312.000057"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "<@U02DJQSG8> well I can't do that If i'm not able to run any command from DRP...",
        "edited": {
            "user": "U8FAN7PLK",
            "ts": "1526065348.000000"
        },
        "ts": "1526065335.000665"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "taking a look at `stage1.cmd.tmpl` that comes with DRP, I don't see anything special about this script:\n```write-host \"Starting Windows install...\"\nQ:\\{{.Env.OS.Name}}\\install\\setup.exe \/noreboot \/unattend:Q:\\machines\\{{.Machine.UUID}}\\unattend.xml\n\n\n$setupRunning = $true\nwhile ($setupRunning) {\n      Start-Sleep -Seconds 10\n      Get-Process -Name setup\n      $setupRunning = $?\n}\nwrite-host \"Updating boot environment\"\ndrpcli nodes update {{.Machine.UUID}} '{\"\"\"\"BootEnv\"\"\"\": \"\"\"\"local\"\"\"\"}'\n\nwrite-host \"Rebooting system\"\nRestart-Computer\n```",
        "ts": "1526065491.000441"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "im gonna create a template of its own and try with that.",
        "ts": "1526065522.000322"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "well, same result :disappointed:",
        "ts": "1526065700.000041"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "looking at the logs I got a bunch of these errors:\n```May 11 15:07:54 pdc-a5g-bms01 dr-provision: dr-provision2018\/05\/11 19:07:54.671197 [279621:31413]frontend [ warn]: \/home\/travis\/gopath\/src\/github.com\/digitalrebar\/provision\/frontend\/frontend.go:163\nMay 11 15:07:54 pdc-a5g-bms01 dr-provision: [279621:31413]No DRP authentication token```\nI don't think it's related though.\n\nOn the other hand when I launch my task I got this:\n```May 11 15:08:54 pdc-a5g-bms01 dr-provision: dr-provision2018\/05\/11 19:08:54.610779 [279675:31422]frontend [ warn]: \/home\/travis\/gopath\/src\/github.com\/digitalrebar\/provision\/frontend\/jobs.go:433\nMay 11 15:08:54 pdc-a5g-bms01 dr-provision: [279675:31422]Machine 8af50e62-70f1-42b6-ad68-1297df75ae8d task windows-network-config-hp at 0 is created, conflict```\n\nAny idea what that mean ?",
        "edited": {
            "user": "U8FAN7PLK",
            "ts": "1526066349.000000"
        },
        "ts": "1526066200.000604"
    },
    {
        "type": "message",
        "user": "UA469LS02",
        "text": "you can run powershell on linux now, in case oyu didn't know",
        "ts": "1526066617.000129"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "well i'm out of ideas.",
        "ts": "1526068167.000353"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "There is nothing in the jobs logs?",
        "ts": "1526068414.000402"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "nothing :disappointed:",
        "ts": "1526068483.000074"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "hmm - so that error means that drpcli tried to run the task, but had an issue.  Then something tried to restart that task.",
        "ts": "1526068964.000011"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "can you from the windows machine, do this:",
        "ts": "1526068985.000326"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "`drpcli.exe -U user -P password machines processjobs UUID`",
        "edited": {
            "user": "U02DGQYK1",
            "ts": "1526069014.000000"
        },
        "ts": "1526069006.000398"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "trying",
        "ts": "1526069059.000240"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "gimme a sec",
        "ts": "1526069063.000149"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "Where is `drpcli` supposed to be located?",
        "ts": "1526069200.000552"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "nevermind, got it",
        "ts": "1526069221.000392"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "interesting: ```Error: Error creating session: CLIENT_ERROR: Get <https:\/\/127.0.0.1:8092\/api\/v3\/users\/user\/token>: dial tcp 127.0.0.1:8092: connectex: No connection could be made because the target\nmachine actively refused it.``` it tries to connect to itself.",
        "ts": "1526069329.000059"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "-E https:\/\/&lt;DRPIP&gt;:8092",
        "ts": "1526069345.000152"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": ":smile:",
        "ts": "1526069350.000230"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "```PS C:\\&gt; .\\usr\\local\\bin\\drpcli.exe -U ***-P *** -E \"<https:\/\/10.0.49.254:8092>\" machines processjobs 8af50e62-70f1-42b6-ad68-1297df75ae8d\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete\nAgent running task\nRunner created for task 932b5b86-4cfa-40ff-bea4-54b97e0e99b4:windows-network-config-hp (0:1)Error during run: file type does not support deadline\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable```",
        "ts": "1526069541.000491"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Okay - looking",
        "ts": "1526069804.000124"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "sigh",
        "ts": "1526069875.000033"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - I see what the shortterm problem is.",
        "ts": "1526069881.000146"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "meaning there is a longterm problem I guess :slightly_smiling_face:",
        "ts": "1526069903.000329"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "windows is the long term problem.",
        "ts": "1526069914.000405",
        "reactions": [
            {
                "name": "joy",
                "users": [
                    "U8FAN7PLK",
                    "U54E4SD4G"
                ],
                "count": 2
            }
        ]
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "LOL",
        "ts": "1526069931.000129"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "just a minute",
        "ts": "1526070028.000459"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "if this is too big of a hassle, I guess we could run it inside cloud-init though.",
        "ts": "1526070119.000101"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yeah, but …",
        "ts": "1526070126.000135"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I’d like this to work.",
        "ts": "1526070129.000386"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "me too",
        "ts": "1526070142.000005"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "I'm pretty sure we are going to need to run powershell code from DRP at some point.",
        "ts": "1526070157.000063"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - two more seconds.",
        "ts": "1526070346.000035"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Try this drpcli.  Put it on the victim of choice.",
        "ts": "1526070395.000590"
    },
    {
        "type": "message",
        "subtype": "file_share",
        "text": "<@U02DGQYK1> uploaded a file: <https:\/\/rackn.slack.com\/files\/U02DGQYK1\/FANGGL8R0\/drpcli.exe|drpcli.exe> and commented: windows cli with fixed deadline code.",
        "file": {
            "id": "FANGGL8R0",
            "created": 1526070500,
            "timestamp": 1526070500,
            "name": "drpcli.exe",
            "title": "drpcli.exe",
            "mimetype": "application\/octet-stream",
            "filetype": "binary",
            "pretty_type": "Binary",
            "user": "U02DGQYK1",
            "editable": false,
            "size": 8512512,
            "mode": "hosted",
            "is_external": false,
            "external_type": "",
            "is_public": true,
            "public_url_shared": false,
            "display_as_bot": false,
            "username": "",
            "url_private": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FANGGL8R0\/drpcli.exe?t=xoxe-2458848645-380882575011-380758634548-f60f5f775ebc6a71b39246bfc0435c36",
            "url_private_download": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FANGGL8R0\/download\/drpcli.exe?t=xoxe-2458848645-380882575011-380758634548-f60f5f775ebc6a71b39246bfc0435c36",
            "permalink": "https:\/\/rackn.slack.com\/files\/U02DGQYK1\/FANGGL8R0\/drpcli.exe",
            "permalink_public": "https:\/\/slack-files.com\/T02DGQYJZ-FANGGL8R0-ee5e733f7d",
            "channels": [],
            "groups": [],
            "ims": [],
            "comments_count": 1,
            "initial_comment": {
                "id": "FcANGGLK6E",
                "created": 1526070500,
                "timestamp": 1526070500,
                "user": "U02DGQYK1",
                "is_intro": true,
                "comment": "windows cli with fixed deadline code."
            }
        },
        "user": "U02DGQYK1",
        "upload": true,
        "display_as_bot": false,
        "username": "greg",
        "bot_id": null,
        "ts": "1526070501.000585"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "same result :disappointed:",
        "ts": "1526070589.000019"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "```Agent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete\nAgent running task\nError during run: Conflict: Machine 8af50e62-70f1-42b6-ad68-1297df75ae8d already has running or created job\nAgent in init```",
        "ts": "1526070678.000100"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "That is different.",
        "ts": "1526070688.000434"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "yeah",
        "ts": "1526070692.000123"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "I guess I should clean the machine of any task before.",
        "ts": "1526070703.000370"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Force the machine’s job to failed.",
        "ts": "1526070712.000301"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Then redo the process jobs.",
        "ts": "1526070719.000146"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You can put the file in files\/drpcli.amd64.windows (or whatever it is).  Just don’t restart drp.",
        "ts": "1526071214.000424"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "it's in \/usr\/local\/bin",
        "ts": "1526071236.000455"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I mean on DRP so that it will get installed correctly next time.",
        "ts": "1526071260.000116"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "oh ok",
        "ts": "1526071267.000118"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "DRP has a copy in itself.  If drp restarts, it will replace it.",
        "ts": "1526071275.000472"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "This will work until we get a new tip out there.",
        "ts": "1526071292.000365"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "mmm",
        "ts": "1526071307.000011"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Assuming it will work.",
        "ts": "1526071309.000376"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "I can't seem to be  able to clear the task off the machine.",
        "ts": "1526071318.000337"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "`drpcli jobs update &lt;jobid&gt; '{ \"State\": \"failed\" }'`",
        "ts": "1526071348.000519"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "here's what I got:\n```Agent running task\nError during run: Conflict: Machine 8af50e62-70f1-42b6-ad68-1297df75ae8d already has running or created job\nAgent in init\nError during run: PATCH: jobs\/13740c6c-83bb-465e-91fe-f55fdbbd837b\n  Patch error at line 0: Test op failed.\n  Patch line: {\"op\":\"test\",\"path\":\"\/State\",\"from\":\"\",\"value\":\"created\"}\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable```",
        "ts": "1526071350.000185"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "`drpcli jobs update 13740c6c-83bb-465e-91fe-f55fdbbd837b '{ \"State\": \"failed\" }'`",
        "ts": "1526071395.000534"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "`drpcli machines update 8af50e62-70f1-42b6-ad68-1297df75ae8d '{ \"Runnable\": true }'`",
        "ts": "1526071420.000503"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "```Agent running task\nRunner created for task 440f25d0-95a1-4db5-b53a-7d83816fa06e:windows-network-config-hp (0:1)Starting task windows-network-config-hp on 8af50e62-70f1-42b6-ad68-1297df75ae8d\nStarting command .\/windows-network-config-hp-windows-network-config-hp.cmd.tmpl\n\n\nCommand failed to start: fork\/exec .\/windows-network-config-hp-windows-network-config-hp.cmd.tmpl: %1 is not a valid Win32 application.\nUpdated job 440f25d0-95a1-4db5-b53a-7d83816fa06e to incomplete\nError during run: RUNNER_ERR: jobs\/440f25d0-95a1-4db5-b53a-7d83816fa06e: fork\/exec .\/windows-network-config-hp-windows-network-config-hp.cmd.tmpl: %1 is not a valid Win32 applicati\non.\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete```",
        "ts": "1526071515.000324"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "something new!",
        "ts": "1526071572.000290"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay",
        "ts": "1526071579.000104"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "That is betterer",
        "ts": "1526071593.000440"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Can you show me the task in question?",
        "ts": "1526071622.000306"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "the json blob ?",
        "ts": "1526071634.000182"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "sure",
        "ts": "1526071641.000069"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "```{\n  \"Available\": true,\n  \"Description\": \"\",\n  \"Documentation\": \"\",\n  \"Errors\": [],\n  \"Meta\": {\n    \"color\": \"black\",\n    \"feature-flags\": \"sane-exit-codes\",\n    \"icon\": \"file text outline\",\n    \"title\": \"\"\n  },\n  \"Name\": \"windows-network-config-hp\",\n  \"OptionalParams\": [],\n  \"ReadOnly\": false,\n  \"RequiredParams\": [],\n  \"Templates\": [\n    {\n      \"Contents\": \"\",\n      \"ID\": \"windows-network-config-hp.cmd.tmpl\",\n      \"Name\": \"windows-network-config\",\n      \"Path\": \"\"\n    }\n  ],\n  \"Validated\": true\n}\n```",
        "ts": "1526071673.000189"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "and the template:\n```{\n  \"Available\": true,\n  \"Contents\": \"write-host \\\"Configuring bonding bond0\\\"\\r\\n$nics = Get-Content -Raw -Path C:\\\\network.json | ConvertFrom-Json\\r\\n$adapters = Get-NetAdapter\\r\\n\\r\\nforeach ($nic in $nics.config)\\r\\n\\t{\\r\\n\\t\\tforeach ($adapter in $adapters) \\r\\n\\t\\t\\t{\\r\\n\\t\\t\\t\\tif ($adapter.MacAddress -eq ($nic.mac_address -replace \\\":\\\",\\\"-\\\")) \\r\\n\\t\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\tGet-NetAdapter -Name $adapter.name | Rename-NetAdapter -NewName $nic.name\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t}\\r\\n\\t}\\r\\nNew-NetLbfoTeam -Name $nics.config[6].name -TeamMembers $nics.config[6].bond_interfaces -AsJob\\r\\n\",\n  \"Description\": \"\",\n  \"Errors\": [],\n  \"ID\": \"windows-network-config-hp.cmd.tmpl\",\n  \"Meta\": {},\n  \"ReadOnly\": false,\n  \"Validated\": true\n}\n```",
        "ts": "1526071710.000437"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Change the template name from `windows-network-config-hp.cmd.tmpl` to `<http:\/\/windows-network-config-hp.ps|windows-network-config-hp.ps>`",
        "ts": "1526071899.000393"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "you mean `windows-network-config-hp.ps1` I'm guessing ?",
        "ts": "1526071936.000453"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - whatever powershell extension is. :slightly_smiling_face:",
        "ts": "1526071959.000049"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "ok",
        "ts": "1526072387.000413"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "so even though the machine had no job\/task running I got this:\n```Agent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete\nAgent running task\nError during run: Conflict: Machine 8af50e62-70f1-42b6-ad68-1297df75ae8d already has running or created job\nAgent in init\nError during run: PATCH: jobs\/398ae62f-b9f1-4183-8f74-8c636fca408a\n  Patch error at line 0: Test op failed.\n  Patch line: {\"op\":\"test\",\"path\":\"\/State\",\"from\":\"\",\"value\":\"created\"}\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable```",
        "ts": "1526072425.000201"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "this is weird",
        "ts": "1526072430.000245"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "well - let me look some more.",
        "ts": "1526072450.000325"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "and after setting up the last job as failed and making the machine runnable still got this errors:\n```Agent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete\nAgent running task\nRunner created for task 53336fd0-0b8e-4c1a-836b-2c0e86d9a638:windows-network-config-hp (0:1)Starting task windows-network-config-hp on 8af50e62-70f1-42b6-ad68-1297df75ae8d\nStarting command .\/windows-network-config-hp-windows-network-config-hp.ps1\n\n\nCommand failed to start: fork\/exec .\/windows-network-config-hp-windows-network-config-hp.ps1: %1 is not a valid Win32 application.\nUpdated job 53336fd0-0b8e-4c1a-836b-2c0e86d9a638 to incomplete\nError during run: RUNNER_ERR: jobs\/53336fd0-0b8e-4c1a-836b-2c0e86d9a638: fork\/exec .\/windows-network-config-hp-windows-network-config-hp.ps1: %1 is not a valid Win32 application.\nAgent in init\nAgent waiting for tasks\nWaiting on machine to become runnable\nWait: finished with complete\nAgent running task\nRunner created for task 53336fd0-0b8e-4c1a-836b-2c0e86d9a638:windows-network-config-hp (0:1)Starting task windows-network-config-hp on 8af50e62-70f1-42b6-ad68-1297df75ae8d\nStarting command .\/windows-network-config-hp-windows-network-config-hp.ps1```",
        "ts": "1526072523.000448"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "ok",
        "ts": "1526072737.000457"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "So - another bug.  The task is failing early and isn’t marking the task as failed.",
        "ts": "1526073154.000298"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "What is the job state when it fails, <@U8FAN7PLK>",
        "ts": "1526073268.000241"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "right now I didn't do anything since the last piece of log, it is still `incomplete`",
        "ts": "1526073309.000172"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay",
        "ts": "1526073318.000003"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "and it's looping :slightly_smiling_face:",
        "ts": "1526073319.000359"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay",
        "ts": "1526073388.000185"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "when running your script by hand, what do you have to do to make it runnable?",
        "ts": "1526073453.000472"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "well i put it in a file `.ps1` and then execute it through a right click or run the command: `powershell .\/name-of-the-script.ps1`",
        "ts": "1526073586.000079"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Ah!  Just add a `right click` action to the `button-press` field in the JSON !!",
        "ts": "1526073616.000215"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - sigh.",
        "ts": "1526073736.000236"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "(my deepest apologies - I couldn't help myself from making that snarky comment ... :slightly_smiling_face: )",
        "ts": "1526073802.000525"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "<@U6QFVRJNB> it's okay, I feel the same :slightly_smiling_face:",
        "ts": "1526073818.000024"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - sooooooo - I’m going to put a huge hack in here for you to try.",
        "ts": "1526073840.000196"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "And then I’m going home. :slightly_smiling_face:",
        "ts": "1526073850.000406"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "best to put huge hacks in place late on a Friday afternoon ...",
        "ts": "1526073870.000155"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "... and chuck it over the wall to Production ...  :slightly_smiling_face:",
        "ts": "1526073889.000067"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "That's the best practice :smile:",
        "ts": "1526073908.000311"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "(and suddenly ... the realization why \"DevOps\" was born ... )",
        "ts": "1526073936.000166"
    },
    {
        "type": "message",
        "subtype": "file_share",
        "text": "<@U02DGQYK1> uploaded a file: <https:\/\/rackn.slack.com\/files\/U02DGQYK1\/FAMSBR996\/drpcli.exe|drpcli.exe> and commented: windows drpcli with powershell exec layer and error path to fail.",
        "file": {
            "id": "FAMSBR996",
            "created": 1526074209,
            "timestamp": 1526074209,
            "name": "drpcli.exe",
            "title": "drpcli.exe",
            "mimetype": "application\/octet-stream",
            "filetype": "binary",
            "pretty_type": "Binary",
            "user": "U02DGQYK1",
            "editable": false,
            "size": 8513536,
            "mode": "hosted",
            "is_external": false,
            "external_type": "",
            "is_public": true,
            "public_url_shared": false,
            "display_as_bot": false,
            "username": "",
            "url_private": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FAMSBR996\/drpcli.exe?t=xoxe-2458848645-380882575011-380758634548-f60f5f775ebc6a71b39246bfc0435c36",
            "url_private_download": "https:\/\/files.slack.com\/files-pri\/T02DGQYJZ-FAMSBR996\/download\/drpcli.exe?t=xoxe-2458848645-380882575011-380758634548-f60f5f775ebc6a71b39246bfc0435c36",
            "permalink": "https:\/\/rackn.slack.com\/files\/U02DGQYK1\/FAMSBR996\/drpcli.exe",
            "permalink_public": "https:\/\/slack-files.com\/T02DGQYJZ-FAMSBR996-ba87803627",
            "channels": [],
            "groups": [],
            "ims": [],
            "comments_count": 1,
            "initial_comment": {
                "id": "FcAPE9EX1U",
                "created": 1526074209,
                "timestamp": 1526074209,
                "user": "U02DGQYK1",
                "is_intro": true,
                "comment": "windows drpcli with powershell exec layer and error path to fail."
            }
        },
        "user": "U02DGQYK1",
        "upload": true,
        "display_as_bot": false,
        "username": "greg",
        "bot_id": null,
        "ts": "1526074210.000357"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Place this in place and give it a whirl.",
        "ts": "1526074230.000112"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "looks like it's working :slightly_smiling_face:",
        "ts": "1526074363.000392"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "yay for late afternoon Friday hacks !",
        "ts": "1526074393.000172"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay I’m going to check it in and ship it.  because …",
        "ts": "1526074409.000393"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "powershell is support if you use a template and name it &lt;blah&gt;.ps1",
        "ts": "1526074447.000510"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "No inline content support.",
        "ts": "1526074456.000383"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "does that include _not_ using the trailing .tmpl defacto we use ?",
        "ts": "1526074511.000014"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yes",
        "ts": "1526074527.000217"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "ok - good to know - thx",
        "ts": "1526074538.000334"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "the .tmpl is just a “note” that we are template expanding, but is not required.  templates can be named anything as long as they are unique.",
        "ts": "1526074570.000376"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "yep",
        "ts": "1526074603.000099"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "w00t",
        "ts": "1526074607.000060"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "so maybe for PS crud - do `&lt;name&gt;.tmpl.ps1` if you wanted to maintain some defacto hint that it's templatized ... and let our fancy hack work",
        "ts": "1526074653.000136"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Yeah, but can windows have dots in middle of names?",
        "ts": "1526074679.000114"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "(because, gasp ... you can't have a 2 character filename extension like `.ps` )",
        "ts": "1526074681.000062"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "will this work if I put his code in the content of a task ?",
        "ts": "1526074701.000124"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "right - so many sharp edges and pointy objects to stab\/slice yourself on with winders ...",
        "ts": "1526074703.000366"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Nope",
        "ts": "1526074711.000445"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "right now it's in a template but don't really need it though.",
        "ts": "1526074712.000228"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "<@U8FAN7PLK> - in about an hour, tip will be these fixes.",
        "ts": "1526074715.000009"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "cool <@U02DGQYK1> :slightly_smiling_face:",
        "ts": "1526074721.000441"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "right now it needs to be a template - not inline Content in a task",
        "ts": "1526074745.000040"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I don’t think so, because we don’t name the task action in that case.  Well, we do, but it may be the name of the task template.",
        "ts": "1526074751.000414"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "i'm okay with that, was just asking.",
        "ts": "1526074756.000412"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "This is brittle and we should think about doing better.",
        "ts": "1526074759.000304"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "at least I will have achieve something today :smile:",
        "ts": "1526074777.000311",
        "reactions": [
            {
                "name": "sunglasses",
                "users": [
                    "U02DHRR2L"
                ],
                "count": 1
            }
        ]
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "because of you :slightly_smiling_face:",
        "ts": "1526074792.000125"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "well i'm going home too.",
        "ts": "1526074921.000396"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "thanks again for the help",
        "ts": "1526074925.000021"
    },
    {
        "type": "message",
        "user": "U8FAN7PLK",
        "text": "have a nice week end !",
        "ts": "1526074927.000314"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "cheers !!",
        "ts": "1526074943.000189"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The filename used to exec is based upon the task template action name,  This is built from the template info struct.  For ID based templates, it is the ID value.  So that translate cleanly (ish).  For Content-based templates, it is the Name value, I think.",
        "ts": "1526074944.000198"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Cool - later.  you too.",
        "ts": "1526074955.000036"
    },
    {
        "user": "UAMTAB49E",
        "text": "<@UAMTAB49E> has joined the channel",
        "type": "message",
        "subtype": "channel_join",
        "ts": "1526079969.000025"
    },
    {
        "type": "message",
        "user": "U02DHRR2L",
        "text": "Hey <@UAMTAB49E> $welcome",
        "client_msg_id": "ec809402-3783-44da-b02a-7ee0da25edf2",
        "ts": "1526080270.000010"
    },
    {
        "text": "Digital Rebar welcome information is here &gt; <http:\/\/rebar.digital\/community\/welcome.html>",
        "type": "message",
        "subtype": "slackbot_response",
        "user": "USLACKBOT",
        "ts": "1526080270.000052"
    },
    {
        "type": "message",
        "user": "UAMTAB49E",
        "text": "Howdy!",
        "client_msg_id": "BE7BE558-627B-41DD-92BD-27FE485DF293",
        "ts": "1526081722.000059"
    }
]