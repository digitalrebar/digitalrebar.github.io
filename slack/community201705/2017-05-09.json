[
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "<@U02DGQYK1> If I want to update an existing profile, can I do the following?\n```\ndrpcli profiles update - &lt; assets\/profiles\/root-access.yaml\n```",
        "edited": {
            "user": "U416T0AAX",
            "ts": "1494359644.000000"
        },
        "ts": "1494359633.938623"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Tried it, throwing an error “requires two arguments”",
        "ts": "1494359701.968084"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "update needs object id",
        "ts": "1494360530.327249"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "then -",
        "ts": "1494360532.328390"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Trying to change the “access_ssh_root_mode” param in the “root-access” profile, doing this:\n```\ndrpcli profiles update \"root-access\" '{ \"access_ssh_root_mode\": \"yes\" }'\n```\nBut no matter what I do, the value remains “true” (instead of “yes”, “no”, etc.)",
        "ts": "1494360546.333860"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Ah - I see, can do:\n```\ndrpcli profiles update \"root-access\" - &lt; assets\/profiles\/root-access.yaml\n```\nand it works",
        "ts": "1494360646.374936"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "<@U02DGQYK1> Trying to enable root access over SSH (yes, I know, bad…)",
        "ts": "1494381904.748321"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "So in my “root-access” profile, I have:\n```\n  access_ssh_root_mode: \"yes\"\n```",
        "ts": "1494381974.758495"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "But when I check my resulting \/etc\/ssh\/sshd_config, I see the following:\n```\nroot@testnode01:~# grep -n ^PermitRoot \/etc\/ssh\/sshd_config\n28:PermitRootLogin prohibit-password\n89:PermitRootLogin without-password\n```",
        "ts": "1494382033.767209"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "line 89 is the one put there by post-install; why isn’t it coming up with ```PermitRootLogin yes``` ??",
        "ts": "1494382100.776996"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Bug probably. I'll check",
        "ts": "1494383126.921601"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "How can I check the rendered preseed template? A URL get?",
        "ts": "1494384868.155625"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yes - the template is part of a bootenv and assigned to a machine.",
        "ts": "1494386361.348246"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The template has a path like: '{{.Machine.Path}}\/compute.ks'",
        "ts": "1494386382.350459"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "This means: http:\/\/&lt;ip&gt;:8091\/machines\/&lt;uuid&gt;\/compute.ks",
        "ts": "1494386410.354206"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "<@U02DGQYK1> Tried <http:\/\/192.168.1.148:8091\/machines\/5fcbf69d-287e-4c2c-b085-5858665cd442\/seed> but getting “404 page not found”",
        "ts": "1494387573.497666"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "n\/m, I see that I have to set the BootEnv for the machine from ‘local’ to (in my case) ‘ubuntu-16.04-install’",
        "ts": "1494387831.528279"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Next question: If I edit a template, do I have to do something to get DRP to pick up on the changes?",
        "ts": "1494388202.573878"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "I am rendering the template, and I don’t see my changes…",
        "ts": "1494388224.576702"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yes - edit the template file.",
        "ts": "1494388841.654231"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "then run: drpcli templates upload filename as filename",
        "ts": "1494388854.656045"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "OK, cool, thanks",
        "ts": "1494388949.669252"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Looks good now",
        "ts": "1494388959.670624"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Hmm, looks like maybe a problem now…",
        "ts": "1494389519.744279"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "So I did:\n```\n[dradmin@dr-admin drp]$ drpcli templates upload assets\/templates\/net-post-install.sh.tmpl as net-post-install.sh.tmpl\n```\nAnd now when I try to get the URL <http:\/\/192.168.1.148:8091\/machines\/5fcbf69d-287e-4c2c-b085-5858665cd442\/post-install.sh> I’m seeing nothing returned…",
        "ts": "1494389611.009335"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "The net_seed.tmpl upload worked OK though, when I get …\/seed I do see the correct preseed",
        "ts": "1494389679.017729"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "usually it is net-post-install.sh",
        "ts": "1494389783.030682"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Template name and path are not always the same.",
        "ts": "1494389797.032431"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "nvm - you are right.",
        "ts": "1494389821.035454"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Yeah, I have:",
        "ts": "1494389831.036772"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "```\n      {\n        \"ID\": \"net-post-install.sh.tmpl\",\n        \"Name\": \"net-post-install.sh\",\n        \"Path\": \"{{.Machine.Path}}\/post-install.sh\"\n      }\n```\nIn the ubuntu-16.04-install bootenv",
        "ts": "1494389861.040246"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "I was previously seeing something when I did a get on the …\/post-install.sh URL",
        "ts": "1494389915.046835"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "make sure the machine's bootenv is still set to ubuntu-16.04",
        "ts": "1494389939.049950"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "It is",
        "ts": "1494389944.050646"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "The …\/post-install.sh URL doesn’t 404 or anything, just returns nothing…",
        "ts": "1494389988.056053"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "okay - so that is usually a render problem.",
        "ts": "1494390005.058191"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You can check the bootenv errors to see if it shows something.  The machine errors could as well",
        "ts": "1494390060.065142"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "drpcli machines show &lt;uuid&gt; | jq .Errors",
        "ts": "1494390071.066635"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The log from dr-provision should show something too.",
        "ts": "1494390106.070877"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "If you need to, you can turn on the debugRenderer preference to 2 and see if it shows anything.",
        "ts": "1494390120.072565"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "It could have a golang template error.",
        "ts": "1494390126.073398"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "No errors in relevant machine or bootenv",
        "ts": "1494390285.093015"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Does dr-provision log to filesystem somewhere, or just to console?",
        "ts": "1494390318.097130"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Now actually I see that I *am* getting a 404 on  …\/post-install.sh URL",
        "ts": "1494390614.134203"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "console",
        "ts": "1494391053.187791"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Had to restart dr-provision to get the console logs back…",
        "ts": "1494391072.190146"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "And I’m seeing:\n```\nr-provision2017\/05\/10 00:22:08.919333 Rendering net-post-install.sh.tmpl for testnode01 booting ubuntu-16.04-install\ndr-provision2017\/05\/10 00:22:08.919393 Static FS: Failed to render template for \/machines\/5fcbf69d-287e-4c2c-b085-5858665cd442\/post-install.sh: template: :54:12: executing \"net-post-install.sh.tmpl\" at &lt;{{template \"set-host...&gt;: template \"set-hostname.tmpl\" not defined\n```",
        "ts": "1494391088.192145"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "there you go.  the set-hostname.tmpl isn't loaded. it appears",
        "ts": "1494391111.194883"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "cd assets\/templates",
        "ts": "1494391124.196571"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "drpcli templates upload set-hostname.tmpl as set-hostname.tmpl",
        "ts": "1494391141.198583"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Hmmm, didn’t change that one, &amp; it exists…\n```\n-rw-r--r-- 1 dradmin dradmin  559 May  3 13:40 set-hostname.tmpl\n```",
        "ts": "1494391190.204752"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yeah - if you upgrade without doing a bootenv install after upgrade, you are probably missing the subtemplates.",
        "ts": "1494391217.208090"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "you can do:\n```\nfor i in `ls *`\ndo\ndrpcli templates upload $i as $i\ndone\n```\nin the assets\/templates directory",
        "ts": "1494391276.215441"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Yup, here’s what I have:\n```\n[dradmin@dr-admin drp]$ drpcli templates list | grep \"ID\"\n    \"ID\": \"default-elilo.tmpl\"\n    \"ID\": \"default-ipxe.tmpl\"\n    \"ID\": \"default-pxelinux.tmpl\"\n    \"ID\": \"local-elilo.tmpl\"\n    \"ID\": \"local-ipxe.tmpl\"\n    \"ID\": \"local-pxelinux.tmpl\"\n    \"ID\": \"net-post-install.sh.tmpl\"\n    \"ID\": \"net_seed.tmpl\"\n    \"ID\": \"set-hostname.tmpl\"\n```",
        "ts": "1494391380.227768"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "you are missing the root-access template",
        "ts": "1494391440.234957"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "and others.",
        "ts": "1494391446.235689"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "bootenv install just loads all templates in templates by default now.",
        "ts": "1494391459.237248"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "So that little script snippet above will add them.",
        "ts": "1494391470.238554"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Or install a new bootenv.",
        "ts": "1494391474.238971"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "OK, looks like they’re all loaded now",
        "ts": "1494391536.246782"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Aaaaaaaaand we’re good!",
        "ts": "1494391568.250763"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "That would explain the no root access.",
        "ts": "1494391571.251287"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Yes",
        "ts": "1494391579.252234"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "hmm - to things to do:",
        "ts": "1494391586.253094"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Time to redeploy",
        "ts": "1494391590.253614"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "1. update the upgrade docs to remind people to reload all templates for that release.\n2. See about making that renderer error show up on the machine errors list.",
        "ts": "1494391643.259906"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Thanks man",
        "ts": "1494391686.265031"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "np",
        "ts": "1494391697.266555"
    }
]