[
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Good morning <@U02DGQYK1> :slightly_smiling_face:",
        "ts": "1494421864.547170"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Got just about everything where I want it now, except the apt sources.list…",
        "ts": "1494421893.557615"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "This is what I’m getting now:\n```\nroot@testnode01:~# grep -v ^# \/etc\/apt\/sources.list | grep -v ^$\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial main restricted\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial-updates main restricted\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial universe\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial-updates universe\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial multiverse\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial-updates multiverse\ndeb <http:\/\/192.168.1.148:8091\/ubuntu-16.04\/install> xenial-backports main restricted universe multiverse\n```",
        "ts": "1494421916.566511"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "We shouldn't be touching it anymore.",
        "ts": "1494421920.568062"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Looks like it is being touched…",
        "ts": "1494421948.578506"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Make sure you aren't setting local_repo as a parameter on anything.",
        "ts": "1494422045.614182"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "n\/m, just found it…\n```\n[dradmin@dr-admin drp]$ cat assets\/profiles\/local-repo.yaml\nName: local-repo\nParams:\n  local_repo: true\n```",
        "ts": "1494422092.631984"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "I did not set it to ‘true’…",
        "ts": "1494422110.639031"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Make sure that isn't assigned to a machine and it isn't set in global.",
        "ts": "1494422126.645330"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Loading it as a profile is okay.  putting it on a machine is not.",
        "ts": "1494422150.653676"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Okay - so - I found the other place.",
        "ts": "1494422211.681398"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You may need to play with it.",
        "ts": "1494422215.683247"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "It is incorporated in a profile I think…",
        "ts": "1494422219.684475"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Adding a profile into the system doesn't directly do anything.",
        "edited": {
            "user": "U02DGQYK1",
            "ts": "1494422249.000000"
        },
        "ts": "1494422244.694753"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Setting the value to ‘false’ should disable this, yes?",
        "ts": "1494422246.695729"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You have to add that profile to the machine's list or make that change to the global profile.",
        "ts": "1494422272.705028"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "You can, but it won't change the problem.",
        "ts": "1494422279.707274"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "The problem is these lines in the preseed file:",
        "ts": "1494422291.711800"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "```\nd-i mirror\/protocol string {{.ParseUrl \"scheme\" .Env.InstallUrl}}\nd-i mirror\/http\/hostname string {{.ParseUrl \"host\" .Env.InstallUrl}}\nd-i mirror\/http\/directory string {{.ParseUrl \"path\" .Env.InstallUrl}}\n```",
        "ts": "1494422303.718423"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "So, DRP apt sources are default still?",
        "ts": "1494422391.753416"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "well - kinda",
        "ts": "1494422401.757523"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "So, I should comment out those preseed file lines?",
        "ts": "1494422580.829647"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "replace them with:",
        "ts": "1494422644.855867"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "```\nd-i mirror\/http\/hostname string <http:\/\/archive.ubuntu.com|archive.ubuntu.com>\nd-i mirror\/http\/directory string \/ubuntu\n```",
        "ts": "1494422649.857922"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "```\n{{if (eq \"debian\" .Env.OS.Family)}}\nd-i mirror\/protocol string http\nd-i mirror\/http\/hostname string <http:\/\/http.us.debian.org|http.us.debian.org>\nd-i mirror\/http\/directory string \/debian\n{{else}}\n{{ if .ParamExists \"local_repo\" }}\n{{ if eq (.Param \"local_repo\") true }}\nd-i mirror\/protocol string {{.ParseUrl \"scheme\" .Env.InstallUrl}}\nd-i mirror\/http\/hostname string {{.ParseUrl \"host\" .Env.InstallUrl}}\nd-i mirror\/http\/directory string {{.ParseUrl \"path\" .Env.InstallUrl}}\n{{else}}\nd-i mirror\/http\/hostname string <http:\/\/archive.ubuntu.com|archive.ubuntu.com>\nd-i mirror\/http\/directory string \/ubuntu \n{{end}}\n{{else}}\nd-i mirror\/http\/hostname string <http:\/\/archive.ubuntu.com|archive.ubuntu.com>\nd-i mirror\/http\/directory string \/ubuntu\n{{end}}\n```",
        "ts": "1494422879.951346"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "That would honor the local_repo var.  I'm going to test that and commit it.",
        "edited": {
            "user": "U02DGQYK1",
            "ts": "1494422905.000000"
        },
        "ts": "1494422896.958107"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "And if the “local-repo” profile is not included in the local machine’s Profile or Profiles list, or in the global profile, then I should get the Ubuntu apt sources then?",
        "ts": "1494423180.078424"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yes - if you add the above piece in place.",
        "ts": "1494423235.100688"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I think.",
        "ts": "1494423242.103725"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I haven't tried it.",
        "ts": "1494423250.107354"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Well here goes nothin’ :slightly_smiling_face:",
        "ts": "1494423478.201963"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Looks like a winner - from rendered seed:\n```\nd-i mirror\/http\/hostname string <http:\/\/archive.ubuntu.com|archive.ubuntu.com>\nd-i mirror\/http\/directory string \/ubuntu\n```",
        "ts": "1494423635.269593"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "I’ll next load the local-repo profile on another test box and see if I get the DRP repo",
        "ts": "1494423699.296662"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Hmm, doesn’t seem to work, get the same lines as above in the seed…",
        "ts": "1494423987.426705"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "n\/m, didn’t add it to the profiles list via drpcli…",
        "ts": "1494424123.487944"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "tip as new commands addprofile removeprofile on machines object.",
        "ts": "1494424142.496682"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "nice",
        "ts": "1494424288.565406"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "At oscon today.  Will be off and on",
        "ts": "1494424317.578923"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "ack",
        "ts": "1494424328.584122"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "OK, with the “local-repo” profile loaded, it does work:\n```\nd-i mirror\/protocol string http\nd-i mirror\/http\/hostname string 192.168.1.148:8091\nd-i mirror\/http\/directory string \/ubuntu-16.04\/install\n```",
        "ts": "1494424377.607150"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "FYI, as far as enabling remote root access…",
        "ts": "1494432945.998138"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "I see the post-install.sh just adds a second “PermitRootLogin” line to sshd_config, to wit:\n```\nroot@testnode02:~# grep -n ^PermitRoot \/etc\/ssh\/sshd_config\n28:PermitRootLogin prohibit-password\n89:PermitRootLogin yes\n```",
        "ts": "1494433167.101811"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "As it turns out, later directives don’t overrule former ones in sshd_config",
        "ts": "1494433221.127836"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Always takes the first directive",
        "ts": "1494433245.138500"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "So, I modified the “root-remote-access.tmpl” thusly:\n```\n{{if .ParamExists \"access_keys\"}}\nmkdir -p \/root\/.ssh\ncat &gt;\/root\/.ssh\/authorized_keys &lt;&lt;EOFSSHACCESS\n### BEGIN GENERATED CONTENT\n{{ range $key := .Param \"access_keys\" }}\n{{$key}}\n{{ end }}\n### END GENERATED CONTENT\nEOFSSHACCESS\n{{end}}\n\nsed --in-place -re '\/^PermitRootLogin\/ s\/prohibit-password\/{{if .ParamExists \"access_ssh_root_mode\"}}{{.Param \"access_ssh_root_mode\"}}{{else}}without-password{{end}}\/' \/etc\/ssh\/sshd_config\n```",
        "ts": "1494433374.197936"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Which generates when rendered:\n```\nmkdir -p \/root\/.ssh\ncat &gt;\/root\/.ssh\/authorized_keys &lt;&lt;EOFSSHACCESS\n### BEGIN GENERATED CONTENT\n\nssh-rsa [redacted] will@Wills-MacBook-Air\n\n### END GENERATED CONTENT\nEOFSSHACCESS\n\n\nsed --in-place -re '\/^PermitRootLogin\/ s\/prohibit-password\/yes\/' \/etc\/ssh\/sshd_config\n```",
        "ts": "1494433466.240256"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "cool",
        "ts": "1494433963.474209"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "I'll look to pull something like that in.",
        "ts": "1494433989.485775"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Did not fix “AcceptEnv” yet — \n```\nroot@testnode02:~# grep -n ^AcceptEnv \/etc\/ssh\/sshd_config\n75:AcceptEnv LANG LC_*\n90:AcceptEnv http_proxy https_proxy no_proxy\n```",
        "ts": "1494434059.517497"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "It should probably removed.",
        "ts": "1494434084.528789"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "You need line 90 for proxy environments?",
        "ts": "1494434085.529516"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "yes",
        "ts": "1494434109.540410"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "well - for our DR runners",
        "ts": "1494434117.544142"
    },
    {
        "type": "message",
        "user": "U416T0AAX",
        "text": "Then I guess ” http_proxy https_proxy no_proxy” should be added at the end of “AcceptEnv LANG LC_*”",
        "ts": "1494434189.575512"
    },
    {
        "type": "message",
        "user": "U02DGQYK1",
        "text": "Yeah - not sure. Probably.",
        "ts": "1494434200.580655"
    }
]