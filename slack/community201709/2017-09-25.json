[
    {
        "text": "A n00b here. Any pointers on how to figure out why a machine is getting a dhcp lease from dr-prov, but not completing the pxe boot?",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382057.000068"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Hello @nzsouthernman, welcome!  What version of Digital Rebar Provision are you running ?",
        "ts": "1506382118.000011"
    },
    {
        "text": "check \"drpcli prefs list\" - make sure that you have set the unknown bootenv and default bootenv",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382129.000231"
    },
    {
        "text": "Running whichever version is 'stable' as of this morning.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382211.000077"
    },
    {
        "text": "defaultboot is slegehammer, unknown is discovery.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382239.000112"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Excellent -that should be the 3.1.0 release - you can verify this with `drpcli version`",
        "ts": "1506382315.000170"
    },
    {
        "text": "Version: v3.1.0-0-b70cf8ee1f61844a6d64070a8b272c2bec512204",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382340.000011"
    },
    {
        "text": ":)",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382341.000185"
    },
    {
        "text": "Currently running host &amp; pxeclient on vmware, on an isolated vswitch that has a firewall between it &amp; our core.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382371.000106"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "you can also take a look at things with the UI - if you haven't seen it already - simply point your web browser to your DRP endpoint w\/ https and port 8092",
        "ts": "1506382438.000076"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "The UI is running as the RackN portal - and your web browser proxies the connection to your DRP endpoint - your DRP endpoint does NOT reach out to the Portal",
        "ts": "1506382481.000078"
    },
    {
        "text": "Yeah, got the ui running (it's very nice btw), and checked the ISO's and earlier found that the initial sledgehammer I uploaded from the cli wasn't what the ui wanted. Downloaded and uploaded via the ui the sledgehammer b68 version and that appears to have made it happy.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382515.000251"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "presumably you see your pxeclient show up under the `Machines` inventory ?",
        "ts": "1506382610.000012"
    },
    {
        "text": "*made the ui happy. The pxeboot still doesn't seem to respond still.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382610.000159"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "wha bootenv does it show ?",
        "ts": "1506382615.000222"
    },
    {
        "text": "Nope. I only see the MAC under the Networking\\leases as evidence that something's working.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382640.000222"
    },
    {
        "text": "I had dhcp logging going and syslog showed the event.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382661.000230"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "could you please run `drpcli info get` for us?",
        "ts": "1506382811.000202"
    },
    {
        "text": "{\n  \"api_port\": 8092,\n  \"arch\": \"amd64\",\n  \"dhcp_enabled\": true,\n  \"file_port\": 8091,\n  \"id\": \"00:50:56:9e:ec:bf\",\n  \"os\": \"linux\",\n  \"prov_enabled\": true,\n  \"stats\": [\n    {\n      \"count\": 0,\n      \"name\": \"machines.count\"\n    },\n    {\n      \"count\": 1,\n      \"name\": \"subnets.count\"\n    }\n  ],\n  \"tftp_enabled\": true,\n  \"version\": \"v3.1.0-0-b70cf8ee1f61844a6d64070a8b272c2bec512204\"\n}\n",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382847.000060"
    },
    {
        "text": "[<https:\/\/files.gitter.im\/digitalrebar\/core\/oJpG\/image.png|image.png](https:\/\/files.gitter.im\/digitalrebar\/core\/oJpG\/thumb\/image.png)>",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "attachments": [
            {
                "fallback": "218x772px image",
                "image_url": "https:\/\/files.gitter.im\/digitalrebar\/core\/oJpG\/image.png",
                "image_width": 218,
                "image_height": 772,
                "image_bytes": 32240,
                "from_url": "https:\/\/files.gitter.im\/digitalrebar\/core\/oJpG\/image.png",
                "id": 1
            }
        ],
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382960.000085"
    },
    {
        "text": "Possibly something wrong with the DHCP config?",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506382975.000071"
    },
    {
        "text": "it's a UX issue - can you get the subnet list from the CLI?  I'll look at the UX render issue.  It would help to have your subnet entry",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506383039.000118"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "sorry - you're seeing a current UX bug right now (UX is still in tech preview status) ... can you please do from CLI ?",
        "ts": "1506383043.000250"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": ":slightly_smiling_face:",
        "ts": "1506383049.000001"
    },
    {
        "text": ":D",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506383058.000088"
    },
    {
        "text": "[\n  {\n    \"ActiveEnd\": \"192.168.1.200\",\n    \"ActiveLeaseTime\": 60,\n    \"ActiveStart\": \"192.168.1.100\",\n    \"Available\": true,\n    \"Enabled\": true,\n    \"Errors\": [],\n    \"Name\": \"ens192\",\n    \"NextServer\": \"192.168.1.10\",\n    \"OnlyReservations\": false,\n    \"Options\": [\n      {\n        \"Code\": 0,\n        \"Value\": \"[object Object]\"\n      },\n      {\n        \"Code\": 1,\n        \"Value\": \"255.255.255.0\"\n      },\n      {\n        \"Code\": 2,\n        \"Value\": \"[object Object]\"\n      },\n      {\n        \"Code\": 3,\n        \"Value\": \"[object Object]\"\n      },\n      {\n        \"Code\": 4,\n        \"Value\": \"[object Object]\"\n      },\n      {\n        \"Code\": 5,\n        \"Value\": \"[object Object]\"\n      },\n      {\n        \"Code\": 28,\n        \"Value\": \"192.168.1.255\"\n      }\n    ],\n    \"Pickers\": [\n      \"hint\",\n      \"nextFree\",\n      \"mostExpired\"\n    ],\n    \"ReadOnly\": false,\n    \"ReservedLeaseTime\": 7200,\n    \"Strategy\": \"MAC\",\n    \"Subnet\": \"192.168.1.10\/24\",\n    \"Validated\": true\n  }\n]",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506383095.000294"
    },
    {
        "text": "Hmm, maybe I should delete and recreate my subnet from drpcli?",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506383159.000146"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "what is your \"Reservation\" strategy?  Do you have reservations required ?",
        "ts": "1506383248.000092"
    },
    {
        "text": "No, no reservations required. host is 192.168.1.10, fw is 192.168.1.1, dhcp scope set 192.168.1.100-192.168.1.200. It's a test ip range, so pretty much anything is fine.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506383320.000225"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "can you add a TFTP client to your endpoint (eg \"yum install tftp\" or \"apt -y install tftp-hpa\")\nthen check that TFTP is working for you with this basic test:\n```tftp 127.0.0.1\nget default.ipxe```",
        "ts": "1506383839.000043"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "even better would be a client in the same vswitch that has access to your endpoint - then hit your endpoint IP (192.168.1.10) for same test",
        "ts": "1506383905.000005"
    },
    {
        "text": "Testing what? browser to ui? I can bring up a linux vm on that vswitch pretty quickly.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506384002.000106"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "testing basic TFTP to the drp endpoint",
        "ts": "1506384042.000115"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "and that your tftpboot is serving the `default.ipxe` file",
        "ts": "1506384055.000213"
    },
    {
        "text": "Adjusted dhcp to look like this;",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506384883.000164"
    },
    {
        "text": "[\n  {\n    \"ActiveEnd\": \"192.168.1.200\",\n    \"ActiveLeaseTime\": 60,\n    \"ActiveStart\": \"192.168.1.100\",\n    \"Available\": true,\n    \"Enabled\": true,\n    \"Errors\": [],\n    \"Name\": \"ens192\",\n    \"NextServer\": \"192.168.1.10\",\n    \"OnlyReservations\": false,\n    \"Options\": [\n      {\n        \"Code\": 1,\n        \"Value\": \"255.255.255.0\"\n      },\n      {\n        \"Code\": 3,\n        \"Value\": \"192.168.1.1\"\n      },\n      {\n        \"Code\": 6,\n        \"Value\": \"192.168.1.1\"\n      },\n      {\n        \"Code\": 28,\n        \"Value\": \"192.168.1.255\"\n      }\n    ],\n    \"Pickers\": [\n      \"hint\",\n      \"nextFree\",\n      \"mostExpired\"\n    ],\n    \"ReadOnly\": false,\n    \"ReservedLeaseTime\": 7200,\n    \"Strategy\": \"MAC\",\n    \"Subnet\": \"192.168.1.10\/24\",\n    \"Validated\": true\n  }\n]",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506384886.000054"
    },
    {
        "text": "No pxeboot stuff though. Which option should that go in?",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506384914.000223"
    },
    {
        "text": "                      {Code: 3, Value: ip},\n                      {Code: 6, Value: ip},\n                      {Code: 15, Value: 'example.com'},\n                      {Code: 67, Value: 'lpxelinux.0'},\n                    ]",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385058.000061"
    },
    {
        "text": "where IP is generally from the drpcli interfaces list",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385079.000032"
    },
    {
        "text": "sorry about the UX bug... will get that updated tonight",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385102.000167"
    },
    {
        "text": "No worries about the UX, that stuff happens in products under dev. Current DHCP schema follows;",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385359.000037"
    },
    {
        "text": "{\n  \"ActiveEnd\": \"192.168.1.200\",\n  \"ActiveLeaseTime\": 60,\n  \"ActiveStart\": \"192.168.1.100\",\n  \"Available\": true,\n  \"Enabled\": true,\n  \"Errors\": [],\n  \"Name\": \"ens192\",\n  \"NextServer\": \"192.168.1.10\",\n  \"OnlyReservations\": false,\n  \"Options\": [\n    {\n      \"Code\": 1,\n      \"Value\": \"255.255.255.0\"\n    },\n    {\n      \"Code\": 3,\n      \"Value\": \"192.168.1.1\"\n    },\n    {\n      \"Code\": 6,\n      \"Value\": \"192.168.1.1\"\n    },\n    {\n      \"Code\": 15,\n      \"Value\": \"burnside.school.nz\"\n    },\n    {\n      \"Code\": 28,\n      \"Value\": \"192.168.1.255\"\n    },\n    {\n      \"Code\": 67,\n      \"Value\": \"lpxelinux.0\"\n    }\n  ],\n  \"Pickers\": [\n    \"hint\",\n    \"nextFree\",\n    \"mostExpired\"\n  ],\n  \"ReadOnly\": false,\n  \"ReservedLeaseTime\": 7200,\n  \"Strategy\": \"MAC\",\n  \"Subnet\": \"192.168.1.10\/24\",\n  \"Validated\": true\n}\n",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385361.000191"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "FYI - your DRP endpoint does have a built in API documentation set - based on swagger:\n<https:\/\/127.0.0.1:8092\/swagger-ui\/#\/>",
        "ts": "1506385443.000215"
    },
    {
        "text": "Unfortunately, still no pxeboot from my test client.  The ubuntu VM I popped onto the subnet can browse ok now though.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385452.000107"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "Replace localhost w\/ your endpoint URL - and you may need to update the Swagger URL bar with the correct IP addr",
        "ts": "1506385479.000101"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "(though, admittedly - it doesn't document the DHCP option codes :slightly_smiling_face: )",
        "ts": "1506385493.000229"
    },
    {
        "text": "Hmmm, the test vm can browse externally, but can't access either the ui, or the swagger ui.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385553.000077"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "is your test vm able to tftp to the drp endpoint ?   (also swagger-ui is HTTPS ... won't work on unencrypted http)",
        "ts": "1506385648.000218"
    },
    {
        "text": "Gotchya. Swagger works on https. Initially tried to redirect me to 127.0.0.1, but changing the redir to 192.168.1.10 brought up the ui. Will test tftp to the endpoint shortly.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385738.000019"
    },
    {
        "text": "would you mind sharing the parameter list you started DRP with?  it you did not set the static-ip then it could cause this problem",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385792.000014"
    },
    {
        "text": "Also, it would be helpful to have your drpcli interfaces show list",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385798.000009"
    },
    {
        "text": "[\n  {\n    \"ActiveAddress\": \"192.168.1.10\/24\",\n    \"Addresses\": [\n      \"192.168.1.10\/24\"\n    ],\n    \"Index\": 3,\n    \"Name\": \"ens192\",\n    \"ReadOnly\": true\n  }\n]",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385892.000084"
    },
    {
        "text": "systemd started the daemon, I'll dig around and see if I can find what it passed to the initial run of it.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385914.000095"
    },
    {
        "text": "This was what I told it; sudo systemctl daemon-reload &amp;&amp; sudo systemctl enable dr-provision",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506385941.000140"
    },
    {
        "text": "This is what systemd has to say about the service;",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386005.000247"
    },
    {
        "text": "[Unit]\nDescription=DigitalRebar Provision Integrated DHCP and File Provisioner\nDocumentation=http:\/\/provision.readthedocs.io\/en\/latest\/\nAfter=network.target\n\n[Service]\nExecStart=\/usr\/local\/bin\/dr-provision\nLimitNOFILE=1048576\nLimitNPROC=1048576\nLimitCORE=infinity\nTasksMax=infinity\n\n[Install]\nWantedBy=multi-user.target\n",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386008.000096"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "can you please change the ExecStart stanza (in `\/etc\/systemd\/system\/dr-provision.service`) to append the following:\n```--static-port=192.168.1.10```",
        "ts": "1506386143.000217"
    },
    {
        "text": "NOTE: static-ip",
        "username": "zehicle",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386190.000142"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "then `sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart dr-provision`",
        "ts": "1506386193.000077"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "doh :slightly_smiling_face:  thanks <@U02DHRR2L> - yeah (--static-ip=192.168.1.10) ... cut-n-paste of wrong line",
        "ts": "1506386237.000039"
    },
    {
        "text": "● dr-provision.service - DigitalRebar Provision Integrated DHCP and File Provisioner\n   Loaded: loaded (\/etc\/systemd\/system\/dr-provision.service; disabled; vendor preset: enabled)\n   Active: failed (Result: exit-code) since Tue 2017-09-26 13:36:51 NZDT; 1s ago\n     Docs: http:\/\/provision.readthedocs.io\/en\/latest\/\n  Process: 3294 ExecStart=\/usr\/local\/bin\/dr-provision --static-port=192.168.1.10 (code=exited, status=1\/FAILURE)\n Main PID: 3294 (code=exited, status=1\/FAILURE)\n\nSep 26 13:36:51 lcrowbar01 systemd[1]: Started DigitalRebar Provision Integrated DHCP and File Provisioner.\nSep 26 13:36:51 lcrowbar01 dr-provision[3294]: invalid argument for flag `--static-port' (expected int): strconv.ParseInt: parsing \"192.168.1.10\": invalid syntax\nSep 26 13:36:51 lcrowbar01 systemd[1]: dr-provision.service: Main process exited, code=exited, status=1\/FAILURE\nSep 26 13:36:51 lcrowbar01 systemd[1]: dr-provision.service: Unit entered failed state.\nSep 26 13:36:51 lcrowbar01 systemd[1]: dr-provision.service: Failed with result 'exit-code'.\n",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386247.000244"
    },
    {
        "text": "Didn't like that",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386250.000003"
    },
    {
        "text": "feck it, brb...",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386267.000004"
    },
    {
        "text": "that's better. testing now",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386331.000184"
    },
    {
        "text": "Ok. Will stop the daemon and run by hand. Will have another go at this tomorrow, thanks for your help so far today gentlemen.",
        "username": "nzsouthernman_twitter",
        "bot_id": "B41PS9J94",
        "type": "message",
        "subtype": "bot_message",
        "ts": "1506386614.000006"
    },
    {
        "type": "message",
        "user": "U6QFVRJNB",
        "text": "@nzsouthernman - we'll look for you on the channel - cheers !!",
        "ts": "1506386991.000133"
    }
]